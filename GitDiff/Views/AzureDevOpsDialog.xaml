<Window x:Class="GitDiff.Views.AzureDevOpsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Azure DevOps - Work Item → PR → Commits"
        Width="600" Height="560"
        MinWidth="500" MinHeight="400"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource MaterialDesign.Brush.Background}"
        FontFamily="{materialDesign:MaterialDesignFont}">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Settings Expander -->
        <Expander Grid.Row="0" x:Name="SettingsExpander" Margin="0,0,0,8"
                  materialDesign:ExpanderAssist.HorizontalHeaderPadding="0"
                  BorderThickness="0">
            <Expander.Header>
                <TextBlock Text="Settings" FontWeight="SemiBold" FontSize="13" />
            </Expander.Header>
            <Grid Margin="0,4,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="110" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Text="Organization:"
                           VerticalAlignment="Center" FontSize="12" Margin="0,0,8,6" />
                <TextBox Grid.Row="0" Grid.Column="1" x:Name="OrgInput"
                         materialDesign:HintAssist.Hint="myorg"
                         FontSize="12" Margin="0,0,0,6" />

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Project:"
                           VerticalAlignment="Center" FontSize="12" Margin="0,0,8,6" />
                <TextBox Grid.Row="1" Grid.Column="1" x:Name="ProjectInput"
                         materialDesign:HintAssist.Hint="MyProject"
                         FontSize="12" Margin="0,0,0,6" />

                <TextBlock Grid.Row="2" Grid.Column="0" Text="Repository:"
                           VerticalAlignment="Center" FontSize="12" Margin="0,0,8,6" />
                <TextBox Grid.Row="2" Grid.Column="1" x:Name="RepoInput"
                         materialDesign:HintAssist.Hint="MyRepo"
                         FontSize="12" Margin="0,0,0,6" />

                <TextBlock Grid.Row="3" Grid.Column="0" Text="Credential:"
                           VerticalAlignment="Center" FontSize="12" Margin="0,0,8,0" />
                <TextBox Grid.Row="3" Grid.Column="1" x:Name="CredentialTargetInput"
                         materialDesign:HintAssist.Hint="git:https://dev.azure.com/myorg"
                         FontSize="12" />
                <Button Grid.Row="3" Grid.Column="2" Content="Test"
                        Click="TestConnection_Click"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Height="28" Padding="8,2" Margin="4,0,0,0"
                        FontSize="11" />
            </Grid>
        </Expander>

        <Separator Grid.Row="1" Margin="0,0,0,8" />

        <!-- Work Item ID Input -->
        <DockPanel Grid.Row="2" Margin="0,0,0,8">
            <TextBlock DockPanel.Dock="Top" Text="Work Item IDs（スペースまたは改行区切り）"
                       FontSize="13" Margin="0,0,0,4" />
            <Button DockPanel.Dock="Right" Content="取得" Click="FetchButton_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    materialDesign:ButtonAssist.CornerRadius="3"
                    Width="60" Height="50" Margin="8,0,0,0"
                    VerticalAlignment="Top" />
            <TextBox x:Name="WorkItemIdInput"
                     AcceptsReturn="True" TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     FontFamily="Consolas" FontSize="13"
                     materialDesign:HintAssist.Hint="12345 12346 12347"
                     Height="50" />
        </DockPanel>

        <!-- Fetch Results -->
        <DockPanel Grid.Row="3">
            <TextBlock DockPanel.Dock="Top" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,4">
                <Run Text="取得結果" />
                <Run x:Name="CommitCountRun" Text="" Foreground="{DynamicResource PrimaryHueMidBrush}" />
            </TextBlock>
            <TreeView x:Name="ResultsTree"
                      BorderThickness="1"
                      BorderBrush="{DynamicResource MaterialDesign.Brush.TextBox.HoverBackground}"
                      FontSize="12">
                <TreeView.Resources>
                    <Style TargetType="TreeViewItem">
                        <Setter Property="IsExpanded" Value="True" />
                    </Style>
                </TreeView.Resources>
            </TreeView>
        </DockPanel>

        <!-- Status -->
        <DockPanel Grid.Row="4" Margin="0,8,0,0">
            <ProgressBar x:Name="LoadingBar"
                         Style="{StaticResource MaterialDesignCircularProgressBar}"
                         IsIndeterminate="True" Visibility="Collapsed"
                         Width="16" Height="16" Margin="0,0,8,0"
                         DockPanel.Dock="Left" VerticalAlignment="Center" />
            <TextBlock x:Name="StatusText" FontSize="12"
                       Foreground="{DynamicResource MaterialDesign.Brush.ForegroundLight}"
                       VerticalAlignment="Center" TextTrimming="CharacterEllipsis" />
        </DockPanel>

        <!-- Buttons -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button x:Name="OkButton" Content="OK" Click="OkButton_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    materialDesign:ButtonAssist.CornerRadius="3"
                    Width="80" Height="30" Margin="0,0,8,0"
                    IsEnabled="False" />
            <Button Content="Cancel" Click="CancelButton_Click"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    Width="80" Height="30" />
        </StackPanel>
    </Grid>
</Window>
